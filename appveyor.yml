branches:
  only:
    - master

shallow_clone: true
clone_depth: 1

install:
  # Set Qt toolkit path
  - set QTDIR=C:\Qt\5.9\mingw53_32

  # Use MinGW shipped with Qt, since the one on C:\ is different and gives compilation errors!
  - set PATH=%PATH%;%QTDIR%\bin;C:\Qt\Tools\mingw530_32\bin

  # Build Leviathan version file
  - python appveyor_generateversion.py
  
build_script:
  - qmake Leviathan.pro CONFIG+=release
  - mingw32-make -j2

deploy_script:
  - cmd: mkdir deploy
  - cmd: copy /Y release\Leviathan.exe deploy

  # Prepare the libraries and the other files to deploy  
  - C:\Qt\5.9\mingw53_32\bin\windeployqt.exe --force --compiler-runtime --no-translations --no-opengl-sw --no-system-d3d-compiler --no-quick-import --no-angle --no-webkit2 deploy
  - cmd: copy /Y "c:\Qt\tools\mingw530_32\bin\libstdc++-6.dll" deploy
  #- cmd: del deploy\*64*.dll

  # Copy extra required libs
  - cmd: copy /Y ..\winlibs\32\zlib1.dll deploy

  # Pack everything in a zip
  - cmd: 7z a LeviathanWin32-automated.zip deploy\*

#deploy:
#  release: Leviathan automatic build
#  description: ''
#  provider: GitHub
#  auth_token:
#    secure: <your encrypted token> # your encrypted token from GitHub
#  artifact: /.*\.nupkg/            # upload all NuGet packages to release assets
#  draft: false
#  prerelease: false
#  on:
#    branch: master                 # release from master branch only
#    appveyor_repo_tag: true        # deploy on tag push only
